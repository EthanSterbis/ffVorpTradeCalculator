name: Weekly data refresh

on:
  schedule:
    - cron: '0 13 * * 2'
  workflow_dispatch: {}

permissions:
  contents: write

concurrency:
  group: refresh-data
  cancel-in-progress: false

jobs:
  refresh:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: 'release'

      - name: Install R packages
        uses: r-lib/actions/setup-r-dependencies@v2
        with:
          packages: |
            any::nflreadr
            any::dplyr
            any::rlang

      - name: Refresh ffopp.rds
        run: Rscript scripts/refresh_data.R

      - name: Commit & push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore(data): weekly refresh of ffopp.rds"
          file_pattern: data/ffopp.rds
          branch: main
          # Use your account so the commit counts as your contribution:
          commit_user_name: Ethan Sterbis
          commit_user_email: egsterbi@purdue.edu
